IF EXISTS(SELECT NAME FROM SYSOBJECTS WHERE NAME= 'VWK_NOM_ACUMULADOS' AND TYPE='V')
BEGIN
 DROP VIEW VWK_NOM_ACUMULADOS
END
GO
CREATE VIEW DBO.VWK_NOM_ACUMULADOS 
WITH SCHEMABINDING, ENCRYPTION
AS
 SELECT ANO=CAST(NIEPE.ANO AS SMALLINT), MES=CAST(NIEPE.MES AS SMALLINT), FECHA=NPER.FECHAFIN, NIEPE.CNSPAGO, NOMI.DESCRIPCION, 
        NIEPE.NUMDOC,TER.NIT,TER.RAZONSOCIAL, NIEPE.CCOSTO, NOMCCOSTO=CEN.DESCRIPCION, NIEPE.IDAREA, NOMIDAREA=AFU.DESCRIPCION, 
        NIEPED.CODCONCEPTO, NOMCONCEPTO=NCON.DESCRIPCION, NCON.TIPO, NPER.CERRADO, 
        VLR_EMPLEADO = SUM(NIEPED.VALOR), VLR_CONTRATANTE = SUM(NIEPED.VALOR_APORTES), VLR_TOTAL = SUM(NIEPED.TOTAL_NOMINA)
 FROM DBO.NIEPE INNER JOIN DBO.NIEPED ON NIEPE.CNSNIEPE = NIEPED.CNSNIEPE AND NIEPE.NUMDOC=NIEPED.NUMDOC 
      INNER JOIN DBO.NPER ON NIEPE.CNSPAGO = NPER.CNSPAGO 
      INNER JOIN DBO.NEMP ON NIEPE.NUMDOC=NEMP.NUMDOC
      INNER JOIN DBO.TER  ON NEMP.TERCEROID=TER.IDTERCERO
      LEFT JOIN  DBO.NCON ON NIEPED.CODCONCEPTO = NCON.CODCONCEPTO 
      LEFT JOIN  DBO.CEN ON NIEPE.CCOSTO = CEN.CCOSTO 
      LEFT JOIN  DBO.AFU ON NIEPE.IDAREA = AFU.IDAREA 
      LEFT JOIN  DBO.NOMI ON NIEPE.CODNOMINA=NOMI.CODNOMINA
 WHERE NIEPED.INFO='No'
 GROUP BY NIEPE.ANO, NIEPE.MES, NPER.FECHAFIN, NIEPE.CNSPAGO, NOMI.DESCRIPCION, NIEPE.NUMDOC,TER.NIT, TER.RAZONSOCIAL, 
          NIEPE.CCOSTO, CEN.DESCRIPCION, NIEPE.IDAREA, AFU.DESCRIPCION, NIEPED.CODCONCEPTO, NCON.DESCRIPCION, NCON.TIPO, NPER.CERRADO


